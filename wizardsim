-- Script for Auto Farm GUI and NPC Selector with Rayfield and draggable GUI

-- Variables
local player = game.Players.LocalPlayer
local replicatedStorage = game:GetService("ReplicatedStorage")
local npcList = {
    "Dummy", "DummyWarrior", "DummyWizzard", "DummyArcher", "DummySpearman", "DummyKing",
    "GreenSlime", "BigSlime", "Spider", "GiantSpider", "Wolf", "Werewolf", "Bear",
    "StoneGolem", "Lumberjack", "GiantWerewolf", "BeachCrab", "Clam", "RockCrab",
    "Jellyfish", "IceJellyfish", "GreenPirate", "RedPirate", "WaterGolem", "KingPirate",
    "MagmaSlime", "MagmaCrab", "FireAnt", "GiantFireAnt", "MagmaScorpion", "Worm",
    "MagmaSpider", "MagmaGolem", "MagmaKing", "DummyKnight", "DummyArcher2", "DummySpearman2",
    "SmallTreant", "Treant", "SmallWasp", "Wasp", "RockScorpion", "RockTitan", "SmallJello",
    "Cupcake", "Donut", "BigJello", "CandyGolem", "GummyWorm", "GingerbreadSoldier", "GingerbreadWizard",
    "StaticWaypoint"
}
local selectedNPC = "Dummy"
local autoFarm = false

-- Rayfield Loading
local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Rayfield/main/source'))()
local Window = Rayfield:CreateWindow({
    Name = "Auto Farm GUI",
    LoadingTitle = "Initializing",
    LoadingSubtitle = "By WaveAI",
    ConfigurationSaving = {
       Enabled = true,
       FolderName = nil, -- Create a custom folder for configs
       FileName = "AutoFarmSettings"
    },
    KeySystem = false
})

-- Rayfield Tabs and Sections
local Tab = Window:CreateTab("Farming") -- Main tab
local Section = Tab:CreateSection("Auto Farm")

-- Draggable GUI
local function makeDraggable(frame)
    local dragging, dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

-- GUI for selecting NPC
Tab:CreateDropdown({
    Name = "Select NPC",
    Options = npcList,
    CurrentOption = "Dummy",
    Flag = "npcDropdown",
    Callback = function(option)
        selectedNPC = option
    end
})

-- Auto Farm Toggle
Tab:CreateToggle({
    Name = "Auto Farm",
    CurrentValue = false,
    Flag = "AutoFarmToggle",
    Callback = function(value)
        autoFarm = value
        if autoFarm then
            spawn(function()
                while autoFarm do
                    local args = {
                        [1] = 1,
                        [2] = workspace.Levels.Forest.Enemies[selectedNPC]
                    }
                    replicatedStorage.Remote.CastSpell:FireServer(unpack(args))
                    wait(1)
                end
            end)
        end
    end
})

-- Make Rayfield Window Draggable
makeDraggable(Window)
