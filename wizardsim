-- Script for Auto Farm GUI and NPC Selector with Raycasting

-- Variables
local player = game.Players.LocalPlayer
local replicatedStorage = game:GetService("ReplicatedStorage")
local userInputService = game:GetService("UserInputService")
local npcList = {
    "Dummy", "DummyWarrior", "DummyWizzard", "DummyArcher", "DummySpearman", "DummyKing",
    "GreenSlime", "BigSlime", "Spider", "GiantSpider", "Wolf", "Werewolf", "Bear",
    "StoneGolem", "Lumberjack", "GiantWerewolf", "BeachCrab", "Clam", "RockCrab",
    "Jellyfish", "IceJellyfish", "GreenPirate", "RedPirate", "WaterGolem", "KingPirate",
    "MagmaSlime", "MagmaCrab", "FireAnt", "GiantFireAnt", "MagmaScorpion", "Worm",
    "MagmaSpider", "MagmaGolem", "MagmaKing", "DummyKnight", "DummyArcher2", "DummySpearman2",
    "SmallTreant", "Treant", "SmallWasp", "Wasp", "RockScorpion", "RockTitan", "SmallJello",
    "Cupcake", "Donut", "BigJello", "CandyGolem", "GummyWorm", "GingerbreadSoldier", "GingerbreadWizard",
    "StaticWaypoint"
}
local selectedNPC = "Dummy"
local autoFarm = false

-- Create GUI
local ScreenGui = Instance.new("ScreenGui", player.PlayerGui)
local Frame = Instance.new("Frame", ScreenGui)
Frame.Position = UDim2.new(0.1, 0, 0.1, 0)
Frame.Size = UDim2.new(0, 300, 0, 200)
Frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

local npcDropdown = Instance.new("TextButton", Frame)
npcDropdown.Size = UDim2.new(0, 200, 0, 50)
npcDropdown.Position = UDim2.new(0, 50, 0, 50)
npcDropdown.Text = "Select NPC"

local autoFarmToggle = Instance.new("TextButton", Frame)
autoFarmToggle.Size = UDim2.new(0, 200, 0, 50)
autoFarmToggle.Position = UDim2.new(0, 50, 0, 120)
autoFarmToggle.Text = "Auto Farm: OFF"

-- Function to attack NPC using raycasting
local function attackNPC()
    while autoFarm do
        local playerPosition = player.Character.HumanoidRootPart.Position
        local direction = (workspace.Levels.Forest.Enemies[selectedNPC].Position - playerPosition).unit * 100
        
        local ray = Ray.new(playerPosition, direction)
        local hit, position = workspace:FindPartOnRay(ray, player.Character)

        if hit and hit:IsDescendantOf(workspace.Levels.Forest.Enemies) then
            local args = {
                [1] = 1,
                [2] = workspace.Levels.Forest.Enemies[selectedNPC]
            }
            replicatedStorage.Remote.CastSpell:FireServer(unpack(args))
        end
        wait(1) -- Adjust the wait time based on how fast the attacks should happen
    end
end

-- NPC Dropdown click
npcDropdown.MouseButton1Click:Connect(function()
    local npcFrame = Instance.new("Frame", Frame)
    npcFrame.Size = UDim2.new(0, 200, 0, 200)
    npcFrame.Position = UDim2.new(0, 50, 0, 110)
    
    for i, npc in ipairs(npcList) do
        local npcButton = Instance.new("TextButton", npcFrame)
        npcButton.Size = UDim2.new(0, 200, 0, 20)
        npcButton.Position = UDim2.new(0, 0, 0, (i-1) * 20)
        npcButton.Text = npc

        npcButton.MouseButton1Click:Connect(function()
            selectedNPC = npc
            npcDropdown.Text = "NPC: " .. npc
            npcFrame:Destroy() -- Remove NPC selection UI
        end)
    end
end)

-- Auto Farm toggle
autoFarmToggle.MouseButton1Click:Connect(function()
    autoFarm = not autoFarm
    autoFarmToggle.Text = autoFarm and "Auto Farm: ON" or "Auto Farm: OFF"

    if autoFarm then
        attackNPC()
    end
end)
